@inherits BlazorView<MarkdownControl>

@if(Html != null)
{
    @((MarkupString)Html) 
}


@foreach (var component in LayoutAreaComponents)
{
        <LayoutArea Address="@Stream.Owner" Reference="@component.Reference" />
}

@code 
{
    private IReadOnlyList<LayoutAreaComponentInfo> LayoutAreaComponents { get; set; } = [];
    private string Html { get; set; }
    protected override void OnParametersSet()
    {
        base.OnParametersSet();
        DataBind<string>(ViewModel.Data, RenderMarkdown);
    }

    private void RenderMarkdown(string markdown)
    {
        var layoutAreaExtension = new LayoutAreaExtension(Stream.Hub);
        var pipeline = new MarkdownPipelineBuilder()
            .UseAdvancedExtensions()
            .Use(layoutAreaExtension)
            .Build();
        Html = Markdown.ToHtml(markdown, pipeline);
        LayoutAreaComponents = layoutAreaExtension.Parser.Areas;
    }

}