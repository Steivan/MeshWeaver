@using Json.More
@using Json.Pointer

@inherits BlazorView<SelectControl>

<FluentSelect Label="@Label"
              Items="@Options"
              TOption="Option"
              OptionText="@(x => x.Text)"
              OptionValue="@(x => x.GetItem()?.ToString())"
              SelectedOption="@Data"></FluentSelect>

@code
{
    private IEnumerable<Option> Options { get; set; }

    public string GetOptionText(object item) => 
        JsonPointer.Parse(ViewModel.OptionText)
            .Evaluate(item.ToJsonDocument().RootElement)?.GetString();


    private Option data;
    public Option Data
    {
        get => data;
        set => data = Equals(data, value) ? value : SubmitChange(value, ViewModel.Data as JsonPointerReference);
    }


    protected override void OnParametersSet()
    {
        base.OnParametersSet();
        DataBind<IEnumerable<Option>>(ViewModel.Options, x => Options = x);
        DataBind<object>(ViewModel.Data, d => Data = Options.FirstOrDefault(x => x.GetItem().Equals(d)));
    }

}