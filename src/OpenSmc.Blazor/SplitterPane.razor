@using System.Text.Json
@using OpenSmc.Data.Serialization
@inherits BlazorView<SplitterPaneControl>

<FluentMultiSplitterPane
    Collapsible="@ViewModel.Collapsible"
    Collapsed="@ViewModel.Collapsed"
    Max="@ViewModel.Max"
    Min="@ViewModel.Min"
    Size="@ViewModel.Size"
    Resizable="@ViewModel.Resizable"
    Class="@Class"
    >
    <DispatchView ViewModel="@ContentViewModel" Stream="@Stream" Area="@ContentArea" />
</FluentMultiSplitterPane>


@code
{
    UiControl ContentViewModel { get; set; }

    private string ContentArea => $"{Area}/{SplitterPaneControl.ChildContentArea}";

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        Disposables.Add(Stream.Subscribe(item => InvokeAsync(() => Render(item)))); 
    }

    private void Render(ChangeItem<JsonElement> item)
    {
        ContentViewModel = GetControl(item, ContentArea);
        StateHasChanged();
    }
}
