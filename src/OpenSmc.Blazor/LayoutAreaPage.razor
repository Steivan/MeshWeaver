@page "/app/{Application}/{Environment}/{Area}/{*Id}"
@using System.Collections.Immutable
@using OpenSmc.Application
@using OpenSmc.Layout.Domain
@using OpenSmc.Utils


<PageTitle>@PageTitle</PageTitle>

<LayoutArea 
    Address="@Address" 
    Reference="@Reference" 
    Id="@Id" 
    Area="@StandardPageLayout.Page"
    DisplayArea="@Reference.Area"/>

@code{
    private string area;
    private string id;

    [Parameter]
    public string Application { get; set; }
    [Parameter]
    public string Environment { get; set; }

    [Parameter]
    public string Area
    {
        get => area;
        set => area = (string)LayoutAreaReference.Decode(value);
    }

    [Parameter]
    public string Id
    {
        get => id;
        set => id = (string)LayoutAreaReference.Decode(value);
    }

    private string PageTitle => $"{Area.Wordify()} - {Application}";

    [Parameter(CaptureUnmatchedValues = true)]
    public IReadOnlyDictionary<string, object> Options { get; set; } = ImmutableDictionary<string, object>.Empty;
    private object Address => new ApplicationAddress(Application, Environment);

    private LayoutAreaReference Reference => new(Area)
    {
        Id = Id,
        Layout = StandardPageLayout.Page,
        Options =
            Options?
                .ToImmutableDictionary(
                    x => x.Key,
                    x => x.Value is string s 
                        ? LayoutAreaReference.Decode(s) 
                        : x.Value)
            ?? ImmutableDictionary<string, object>.Empty,
    };

}